<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>Theremin</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/water.css@2/out/water.css">
  <link rel="stylesheet" href="11.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pizzicato/0.6.4/Pizzicato.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Holtwood+One+SC&display=swap" rel="stylesheet">
  <link href="11.css" rel="stylesheet" >
  <script src="11.js" type="text/JavaScript"></script>
  <script src="11-auxiliary-functions.js" type="text/JavaScript"></script>

  <script>

window.onload = function () {

    initializeTheremin();
}

const sound = new Pizzicato.Sound();

function startTheremin() {

const autoTuneCheckbox = document.getElementById('autoTuneCheckbox');
const oscillatorType = document.getElementById('oscillatorType').value;
const minFrequency = parseFloat(document.getElementById('minFrequency').value);
const maxFrequency = parseFloat(document.getElementById('maxFrequency').value);
const harmonicIntervalCheckbox = document.getElementById('harmonicIntervalCheckbox');
const soundEffect = document.getElementById('soundEffect').value;

sound.stop();

sound.sourceNode = 'wave'; //this sets the oscillator type
sound.options = {type:oscillatorType};
//this clears previous effects
sound.effects = [];
//this allows me to add effects IF i want

if (soundEffect == 'reverb') {
    const reverb = new Pizzicato.Effects.Reverb();
    sound.addEffect(reverb);
}   else if (soundEffect === 'distortion') {
    const distortion = new Pizzicato.Effects.Distortion();
    sound.addEffect(distortion);
}

document.getElementById('thereminZone').addEventListener('mousemove', function (event) {
    if (sound.playing) {
        const xPosition = event.clientX / window.innerWidth;
        let frequency = minFrequency + (maxFrequency - minFrequency) * xPosition;

        if (autoTuneCheckbox.checked) {
            const midiNote = Math.round(frequencyToMidi(frequency));
            frequency = midiToFrequency(midiNote);
        }
        sound.frequency = frequency;

        document.getElementById('currentFrequency').textContent = frequency.toFixed(2) + 'Hz';
        document.getElementById('currentNote').textContent = noteFromFrequency(frequency);

    }
});

if (harmonicIntervalCheckbox.checked) {
    const intervalFrequency = interval(sound.frequency, 4);
    const secondSound = new Pizzicato.Sound({source: 'wave', options: {type: oscillatorType}, frequency: intervalFrequency});
    secondSound.play();
}
sound.play();

}

function stopTheremin() {
    sound.stop();

}

    </script>
  </head>

<body>
<h1> My Theremin Instrument</h1>

<form id="thereminForm">
    <label>
        Auto-Tune:
        <input type="checkbox" id="autoTuneCheckbox">
    
    </label>
    <label>
        Oscillator Type:
        <select id="oscillatorType">
            <option value="sine">Sine!</option>
            <option value="square">Square!</option>
            <option value="triangle">Triangle!</option>
            <option value="sawtooth">SawTooth!</option>
        </select>
    </label>

    <label>
        Minimum Frequency:
        <input type="number" id="minFrequency" value="20">

    </label>
    <label>
        Maximum Frequency:
        <input type="number" id="maxFrequency" value="2000">

    </label>
    <label>
        Harmonic Interval:
        <input type="checkbox" id="harmonicIntervalCheckbox">

    </label>

    <label>
        Sound Effect:
        <select id="soundEffect">
            <option value="reverb">Reverb</option>
            <option value="distortion">Distortion</option>
        </select>
    </label>

    <button type="button" onclick="startTheremin()">Start!</button>
    <button type="button" onclick="stopTheremin()">Stop!</button>
</form>

<p>Current Frequency:<span id="currentFrequency">0</span>Hz</p>
<p>Current Note: <span id="currentNote">Unknown</span></p>
<div id="thereminZone"></div>

    
</body>
</html>